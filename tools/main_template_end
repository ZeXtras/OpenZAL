
  <target name="zal-common" depends="${JOINED_COMMON_ZIMBRA_JAR_VERSIONS}" />
  <target name="zal-all" depends="${JOINED_ZIMBRA_JAR_VERSIONS}" />

  <target name="clean" description="clean up" >
    <delete includeemptydirs="true">
      <fileset dir="dist/" includes="**/*" />
      <fileset dir="build/" includes="**/*" />
      <fileset dir="tmpsrc/" includes="**/*" />
    </delete>
  </target>

  <target name="doxygen" description="create doxygen documentation" >
    <exec executable="doxygen" />
  </target>

  <target name="check" description="check compatibility of zal jars">

    <if>
      <equals arg1="${VERSION_MICRO}" arg2="0" />
      <then>
        <var name="lastZalPath" value="" />
      </then>
      <else>
        <var name="lastZalPath" value="bin/previous-zal-version.jar" />
      </else>
    </if>

    <for list="${ZIMBRA_VERSIONS}" param="currentZimbraVersion">
      <sequential>
        <if>
          <equals arg1="${lastZalPath}" arg2="" />
          <else>
            <exec failonerror="true" executable="../build-commons/japi-compliance-checker/japi-compliance-checker.pl">
              <arg value="-l"/>
              <arg value="OpenZal"/>
              <arg value="${lastZalPath}"/>
              <arg value="dist/@{currentZimbraVersion}/zal.jar"/>
            </exec>
          </else>
        </if>
        <var name="lastZalPath" value="dist/@{currentZimbraVersion}/zal.jar" />
      </sequential>
    </for>

    <exec failonerror="true" executable="../build-commons/japi-compliance-checker/japi-compliance-checker.pl">
      <arg value="-l"/>
      <arg value="OpenZal"/>
      <arg value="dist/${LAST_ZIMBRA_VERSION}/zal.jar"/>
      <arg value="dist/${FIRST_ZIMBRA_VERSION}/zal.jar"/>
    </exec>
  </target>

  <target name="help">
    <echo>commands availables are:
      zal-all
      zal-common
      zal-{zimbra-version}
      check
      clean
      doxygen
      help
    </echo>
  </target>

</project>